Source code adapted from: https://preshing.com/20120515/memory-reordering-caught-in-the-act/

